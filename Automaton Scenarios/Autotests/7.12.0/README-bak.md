# Базовые сценарии обработки отчетов автоматического тестирования

> ВСЕ ОПУБЛИКОВАННЫЕ СЦЕНАРИИ ЯВЛЯЮТСЯ ТОЛЬКО ПРИМЕРАМИ РЕАЛИЗАЦИИ СЦЕНАРИЕВ АВТОМАТИЗАЦИИ! 
> Их можно и нужно дорабатывать под свои потребности. 

## Сценарий обработки Allure отчетов

[Autotest Builds Parser](./Autotest%20Builds%20Parser.txt)

Тип сценария: `BuildProcessor`

Сценарий анализирует поступающие на вход Allure отчеты, формирует метрики и отправляет результаты в маршрутный узел формирования Сигналов.


## Сценарий создания Сигналов на основании полученных данных из Allure-отчета

[Autotest Signal Processor](./Autotest%20Signal%20by%20Test%20Results.txt)

Тип сценария: `SignalProcessor`

⚠️ Для работы требуется наличие работающего **Сценария обработки Allure отчетов**!

Сценарий обрабатывает сформированные парсером данные прохождения автоматических тестов.


## Сценарий привязки Порогов к Конфигурационным Единицам

[Autotest Signal Processor](./Autotest%20Bind%20Metrics%20to%20CIs.txt)

Тип сценария: `ThresholdsProcessor`

⚠️ Для работы требуется наличие работающего **Сценария обработки Allure отчетов**!

Необходим, если в конфигурации проекта Автотестов включен сбор Метрик.
В таком случае сценарий `Autotest Builds Parser` помимо парсинга теста будет также генерировать 3 метрики:
1. fm_autotest_steps_duration - длительность ШАГА
2. fm_autotest_testcases_duration - длительность ТЕСТ-КЕЙСА
3. fm_autotest_duration - длительность ВСЕГО автотеста

Для работы сценария потребуется настроить Правила порогов по собранным метрикам.

Во вложениях есть Правило порогов, которое также можно импортировать

[Threshold Rule Steps Duration](./Threshold%20Rule%20Steps%20Duration.txt)

В нем необходимо указать тот же Поток данных, который указан в Конфигурации проекта Автотеста.
В настройках порога добавлены Аннотации вида bindci_autotest_projectName.
Это и есть метка Атрибута, по которому будут определяться КЕ для привязки.
Соответственно в необходимые КЕ этот Атрибут необходимо добавить.
В рассматриваемом примере это сделано через так:
1. Настройки → Настройки автоматизации → Библиотеки → Autotest → Структура FT → Свойства: projectName (string)
2. Настройки → Настройка CMDB → Создан новый Тип КЕ "Автотесты" → в Атрибуты КЕ добавлен "autotest" с типом "FT" (созданная на шаге 1 структура)
3. КЕ, к которым планируется привязка порогов, должны быть с этим типом КЕ "Автотесты", а в их Атрибутах типа КЕ → autotest → projectName необходимо указать имя Проекта Автотеста.

Локальная функция в опубликованном сценарии будет искать КЕ именно по этому Атрибуту типа КЕ и привяжет Порог к КЕ только в случае, если КЕ будет найдена.

## Сценарий создания Сигналов на основании Порогов по метрикам Автотестов

[Autotest Signal Processor](./Autotest%20Bind%20Metrics%20to%20CIs.txt)

Тип сценария: `SignalProcessor`

⚠️ Для работы требуется наличие **всех** вышеописанных работающих сценариев!

Сценарий обрабатывает сформированные Пороги и в случае превышения установленных в Правилах порогов лимитов, создает соответствующий Сигнал.

В этом сценарии реализована бонусная опция: если активировать чекбокс локальной переменной Skip_Signal_Create - Сигналы по метрикам шагов (таймауты автотестов) создаваться НЕ БУДУТ, если в системе существует Сигнал провала любого из шагов этого Автотеста.
Если необходимо не только не создавать новые Сигналы по Порогам, но и закрыть уже существующие - в сценарий необходимо добавить расписание в Планировщике запусков. Например установить запуск 1 раз в 2-3 минуты. Тогда, если будет настроен Планировщик и включена опция Skip_Signal_Create, при появлении Сигнала проваленного теста, автоматически закроются Сигналы по Порогам и новые создаваться не будут.

# Базовые примеры сценариев

> [!WARNING]
> ВСЕ ПРЕДСТАВЛЕННЫЕ СЦЕНАРИИ ЯВЛЯЮТСЯ ТОЛЬКО ПРИМЕРАМИ РЕАЛИЗАЦИИ СЦЕНАРИЕВ АВТОМАТИЗАЦИИ! 
>
> Их можно и нужно дорабатывать под свои потребности. 

> [!NOTE]
> Все сценарии после импорта и первоначальной настройки необходимо **Скомпилировать** и **Активировать**.


## Содержание

- [Сценарий проверки покрытия КЕ метриками](#сценарий-проверки-покрытия-ке-метриками)

## Сценарий проверки покрытия КЕ метриками

[**Coverage.txt**](./Coverage.txt)

Тип сценария: `SignalProcessor`

Сценарий предназначен для проверки по расписанию уровня покрытия КЕ мониторингом (метриками) и создания информационных сигналов в случае снижения покрытия

<!-- 
---


### Компоненты и Слоты
Для оценки состояния покрытия мониторингом в типах КЕ опционально можно задать Слоты Компонентов и при привязке Порогов к КЕ указывать к какому из Слотов выполнять эту привязку. 

Демонстрационный сценарий уже включает заготовку для использования этой функции, но требуется выполнить несколько настроек вашего пространства Monq:
1. в настройках CMDB выбрать Тип КЕ (или создать новый), в рамках которого планируется привязывать Пороги с указанием Слотов Компонентов
2. выбрать (или создать новый) компонент, в котором будут указаны Слоты
3. добавить Слоты ([docs 1](https://docs.monq.ru/docs/guide/administration/cmdb-metamodel#%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B8-%D0%BF%D0%BE%D0%BA%D1%80%D1%8B%D1%82%D0%B8%D1%8F-%D0%BC%D0%BE%D0%BD%D0%B8%D1%82%D0%BE%D1%80%D0%B8%D0%BD%D0%B3%D0%BE%D0%BC), [docs 2](https://docs.monq.ru/upgrade/v7/changelog/v7-14-0#%D0%BF%D0%BE%D0%BA%D1%80%D1%8B%D1%82%D0%B8%D0%B5-%D0%BC%D0%BE%D0%BD%D0%B8%D1%82%D0%BE%D1%80%D0%B8%D0%BD%D0%B3%D0%BE%D0%BC))
<img src="./img/04.png" width="600">

4. в Правилах Порогов **обязательно** добавить в Аннотации новое поле с именем `slot` и указать один из Слотов, созданных в п.3,
(и опционально) добавить поле `component`, если Компонентов >1 или название по-умолчанию единственного изменено и ≠ `Common`. В качестве значения указать имя Компонента.
<img src="./img/05.png" width="600">

> [!NOTE]
> Если `component` в Аннотациях не задан, привязка будет выполняться к компоненту по-умолчанию.
>
> У каждого Компонента могут быть собственные Слоты. Это необходимо учитывать при указании имен Компонентов и Слотов в Аннотациях правил Порогов.

## Сценарий создания Сигналов на основе срабатывания Порогов по метрикам

[**Signal Processor for Thresholds.txt**](./Signal-Processor-for-Thresholds.txt)

Тип сценария: `SignalProcessor`

> [!IMPORTANT]
> Даже если привязка Сигналов и Порогов к КЕ не планируется, для работы сигнального сценария требуется наличие активированного [**Сценария привязки Порогов метрик к КЕ**](#сценарий-привязки-порогов-метрик-к-ке), т.к. именно в него первоначально поступают события по порогам и выполняется переадресация этих данных в сигнальный сценарий.

Этот сценарий обрабатывает изменяющиеся пороговые значения метрик, создавая и закрывая Сигналы. Уровни критичности Сигналов соответствуют уровням, установленным в правилах Порогов. 

<img src="./img/09.png" width="600">

Подтверждающие Сигналы не предусмотрены, т.к. если обновленная метрика не выходит за пределы предыдущего порогового значения, сценарий не активируется. В случае изменения Порога, старый Сигнал закрывается и открывается новый, с новым уровнем критичности.

Если необходимые для работы [**Сценария привязки Порогов метрик к КЕ**](#сценарий-привязки-порогов-метрик-к-ке) не были выполнены и у Порогов нет привязанных к ним КЕ, то Сигналы по этим Порогам также будут создаваться без привязки к КЕ.

В качестве дополнительной информации к Сигналу может быть добавлена ссылка на Порог, приведший к открытию Сигнала. Чтобы это произошло, необходимо заполнить локальную переменную `_FQDN` доменным именем инсталляции Monq в формате `monq.domain.ru`

<img src="./img/10.png">

<img src="./img/07.png" width="600">

<img src="./img/08.png" width="600"> -->

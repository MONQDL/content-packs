# vCenter Topology

Сценарий работает с событиями "vim.event.TopologyEvent" получаемыми с помощью потока данных monq типа vCenter.

Для работы сценария, сделайте следующее:

1. Создайте, настройте и запустите поток данных vCenter.
2. Создайте новый сценарий автоматизации и имортируйте его наполнение в формате `base64`.
    > При создании, выберите в качестве владельца Сценария ту же Рабочую группу, что и у Потока.
3. Откройте Сценарий и в самом начале, в блоке "FilterByStreamId" *(обычно является третьим по счету)* замените значение "StreamId" на Id потока *(получить его можно на странице Потока данных)*.
4. Скомпилируйте и активируйте сценарий, дождитесь получения данных в поток – сценарий перехватит данные из потока и автоматически создаст РСМ по полученной топологии.

## Особенности работы сценария

* При создании новых КЕ, сценарий добавляет им лейбл `"source": "vCenter"`, а при обновлении и архивации КЕ сценарий фильтрует объекты по этой метке в рамках своей Рабочей группы. **Поэтому**, КЕ, не обладающие меткой `"source": "vCenter"` или не находящиеся в Рабочей группе Сценария, не будут обработаны.
* На последнем этапе обработки события топологии, сценарий архивирует все КЕ, которые не были созданы или обновлены в текущем прогоне сценария. **Поэтому**, в рамках **одной** РГ не удастся одновременно добавить КЕ из двух различных событий топологии.
* Имя КЕ РСМ должно быть уникально в рамках не только Рабочей группы, но и всего Пользовательского пространства. **Поэтому**, если для двух Рабочих групп настроено построение одинаковых РСМ из vCenter, имена КЕ одной из них будут иметь индекс в названии *(напр., vm-app-01 `(2)`)*.
